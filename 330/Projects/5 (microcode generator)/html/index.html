<html>
<head>
<title>CSCI 330 Project 5 (Microarchitecture)</title>
<style>
.error {
  color: #000;
  background: #ffa20f;
  border: 2px inset #d7b9c9;
}
</style>
<script>

var field_ids = new Array();
var numFields = 5; 

function addFields(num)
{
  // remember the values from the boxes:
  var fvalues = new Array();
  for (i = 0; i< numFields; i++)
    fvalues.push(document.getElementById("f"+i).value);

  t = num+numFields;
  for (i = numFields; i < t; i++)
  {
    document.getElementById('fields').innerHTML += 
       "<input type='text' id=f"+i+" maxlength=5 size=5/>";
    numFields++;
    fvalues.push("");
  }

  // write the values back into the boxes:
  for (i = 0; i < numFields; i++)
    document.getElementById("f"+i).value = fvalues[i];

}

// Check all fields for correctness.
function check() {
  //field_ids = new Array('a', 'b', 'c', 'd', 'e');
  var sum = 0;

  for (i = 0; i < numFields; i++)
  {
 //   fields.push( document.getElementById( "f" + i ) );
    sum += document.getElementById("f"+i).value;
  }

  r = 0;

  for (i = 0; i < numFields; i++)
  {
    if (document.getElementById("f"+i).value == "")
    {
      document.getElementById("f"+i).className="error";
      r = 1
    }
    else
      document.getElementById("f"+i).className="";
   }

  if (sum == 0)
    {
    document.getElementById("average").innerHTML = "No average because you gave no input.";
   return 1;
    }

  return 0;
}


function getXMLHttpReq()
{ var req = null;

if (window.XMLHttpRequest)
   req = new XMLHttpRequest();
else if (window.ActiveXObject)
   req = new ActiveXObject(Microsoft.XMLHTTP);
return req;
}

function sendData(dataStr, url)
{ var req = getXMLHttpReq();

if (req == null)
   return 1;

req.open("POST",
         url,
         true);
req.onreadystatechange = function()
   {
   if(req.readyState == 4)
      {
      if(req.status == 200)
      {
         //alert(req.responseText); /* handle the response here! */
         document.getElementById('average').innerHTML +=req.responseText;
      }
      else
        alert("Error Status: " + req.status + "<br />Error Description: " + req.statusText);
      }
   }
req.setRequestHeader("Content-Type", "text/plain");
req.send(dataStr);
return 0;
}

function submit_data()
{
  if (check() != 0)
    return 0; // don't send data if check doesn't pass!
  data = ""

  for (i=0; i < numFields; i++)
    if (document.getElementById("f"+i).value != "") 
      data += document.getElementById("f"+i).value + "\n";

   document.getElementById("average").innerHTML="";
   sendData(data, "s4.e1.1.cgi");
}


</script>


</head>
<body>
<div name="form-body" style="text-align:center;width:500px;">
<div id="fields">
  <input type=text id="f0" maxlength=5 size=5 value="Next Instr"/>


  <!-- JAM BITS -->
  <label for=JAM1 for=JAM2 for=JAM3 for=JAM4>JAM bits</label>
  <input type=checkbox value=JAM1>JAMN</input>
  <input type=checkbox value=JAM2>JAMZ</input>
  <input type=checkbox value=JAM3>JAMP</input>
  <input type=checkbox value=JAM4>JAMC</input>

  <!-- ALU CONTROL -->

  <input type=text id="f2" maxlength=5 size=5 value="ALU Contr"/>
  <label for=ALUCTRL>ALU Settings</label>
  <select id=ALUCTRL>
    <option value="B011000">A</option>
    <option value="B010100">B</option>
    <option value="B011010">!A</option>
    <option value="B101100">!B</option>
    <option value="B111100">A+B</option>
    <option value="B111101">A+B+1</option>
    <option value="B111001">A+1</option>
    <option value="B110101">B+1</option>
    <option value="B111111">B-A</option>
    <option value="B110110">B-1</option>
    <option value="B111011">-A</option>
    <option value="B001100">A AND B</option>
    <option value="B011100">A OR B</option>
    <option value="B010000">0</option>
    <option value="B110001">1</option>
    <option value="B110010">-1</option>
  </select>

  <!-- ZONE READ -->
  <label for=ZR1 for=ZR2 for=ZR3 for=ZR4>Zone Read</label>
  <input type=checkbox id=ZR1 value=ZR1>Zone 3</input>
  <input type=checkbox id=ZR2 value=ZR2>Zone 2</input>
  <input type=checkbox id=ZR3 value=ZR3>Zone 1</input>
  <input type=checkbox id=ZR4 value=ZR4>Zone 0</input>

  <!-- REGISTER READ -->
  <input type=text id="REG_RD"value="Register RD"/> 

  <!-- PRIMARY MEMORY -->
  <label for=PRMMEM>Primary Memory</label>
  <input type=checkbox id=PRMMEM value=PRMMEM_ACCESS>Access</input>
  <input type=checkbox id=PRMMEM value=PRMMEM_RW>R/W</input>

  <!-- MAD SRC -->
  <label for=MADSRC>MAD SRC</label>
  <select id=MADSRC>
    <option value="B0000">Register 0</option>
    <option value="B0001">Register 1</option>
    <option value="B0010">Register 2</option>
    <option value="B0011">Register 3</option>
    <option value="B0100">Register 4</option>
    <option value="B0101">Register 5</option>
    <option value="B0110">Register 6</option>
    <option value="B0111">Register 7</option>
    <option value="B1110">IR</option>
    <option value="B1111">PC</option>
    <option value="B1000">Zone 0</option>
    <option value="B1001">Zone 1</option>
    <option value="B1010">Zone 2</option>
    <option value="B1011">Zone 3</option>
</select>

  <!-- MDB SRC -->
  <input type=text id="f5" value="MDB SRC">
  <label for=MDBSRC>MDB SRC</label>
  <select id=MDBSRC>
    <option value="B0000">Register 0</option>
    <option value="B0001">Register 1</option>
    <option value="B0010">Register 2</option>
    <option value="B0011">Register 3</option>
    <option value="B0100">Register 4</option>
    <option value="B0101">Register 5</option>
    <option value="B0110">Register 6</option>
    <option value="B0111">Register 7</option>
    <option value="B1110">IR</option>
    <option value="B1111">PC</option>
    <option value="B1000">Zone 0</option>
    <option value="B1001">Zone 1</option>
    <option value="B1010">Zone 2</option>
    <option value="B1011">Zone 3</option>
</select>

  <!-- A SRC -->
  <input type=text id="f5" value="A SOURCE">
  <label for=ASRC>A Source</label>
  <select id=ASRC>
    <option value="B0000">Register 0</option>
    <option value="B0001">Register 1</option>
    <option value="B0010">Register 2</option>
    <option value="B0011">Register 3</option>
    <option value="B0100">Register 4</option>
    <option value="B0101">Register 5</option>
    <option value="B0110">Register 6</option>
    <option value="B0111">Register 7</option>
    <option value="B1110">IR</option>
    <option value="B1111">PC</option>
    <option value="B1000">Zone 0</option>
    <option value="B1001">Zone 1</option>
    <option value="B1010">Zone 2</option>
    <option value="B1011">Zone 3</option>
</select>

  <!-- B SRC -->
  <input type=text id="f5" value="B SOURCE">
  <label for=BSRC>B Source</label>
  <select id=BSRC>
    <option value="B0000">Register 0</option>
    <option value="B0001">Register 1</option>
    <option value="B0010">Register 2</option>
    <option value="B0011">Register 3</option>
    <option value="B0100">Register 4</option>
    <option value="B0101">Register 5</option>
    <option value="B0110">Register 6</option>
    <option value="B0111">Register 7</option>
    <option value="B1110">IR</option>
    <option value="B1111">PC</option>
    <option value="B1000">Zone 0</option>
    <option value="B1001">Zone 1</option>
    <option value="B1010">Zone 2</option>
    <option value="B1011">Zone 3</option>
</select>
  
</div>
  <input type=button id="more" value="More Numbers, Please" onClick="addFields(1);"/>
  <input type=button id="submit" value="Calculate Average" onClick="submit_data();"/>
  <div id="average" style="margin-left:auto;margin-right:auto;margin-top:10px;border-style:dotted; width:400px;padding:4px;"><i>Your answer will be displayed here.</i></div>
</div>
<p>Algorithm Used:
<p> Data Collection: We push all numbers onto a heap-array. When we try to add something more than the size of our array, we replace it with an array 2x the size and move all elements over.
  <ul>
<li> For 1-4 numbers: Sum and divide by number of numbers </li>
<li> For 5 or more numbers: Drop highest and lowest then sum and divide by remaining number of numbers.</li>
</ul>
</body>
</html>
